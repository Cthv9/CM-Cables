<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Calcolatore reale capacitÃ  cavo</title>
  <link rel="manifest" href="manifest.json">
  <link rel="icon" sizes="192x192" href="icon-192.png">
  <link rel="icon" sizes="512x512" href="icon-512.png">
  <meta name="theme-color" content="#2255a4">
  <style>
    *{box-sizing:border-box;}
    body{font-family:Arial,sans-serif;padding:5vw;background:#f9f9f9;}
    .container{background:white;padding:6vw 5vw;border-radius:12px;box-shadow:0 2px 8px #0001;max-width:410px;margin:0 auto;}
    h2{margin-top:0;font-size:2em;}
    label{display:block;margin:16px 0 6px;}
    select,input{width:100%;padding:10px;border-radius:6px;border:1px solid #bbb;font-size:1.1em;}
    button,.lang-btn{margin-top:18px;width:100%;padding:14px 0;border:none;border-radius:8px;background:#2255a4;color:white;font-size:1.15em;cursor:pointer;transition:background 0.2s;}
    button:active,.lang-btn:active{background:#184077;}
    .lang-btn{width:48%;margin:0 1% 20px 0;background:#eee;color:#333;border:1px solid #bbb;font-size:1.1em;}
    .lang-btn.selected{background:#2255a4;color:#fff;border:none;}
    .btn-row{display:flex;gap:4%;}
    .result{margin-top:24px;padding:14px;background:#eef6fa;border-radius:8px;border-left:4px solid #2295d1;font-size:1.15em;}
    #install-btn{display:none;background:#2295d1;font-size:1em;margin-top:18px;width:100%;border-radius:8px;padding:12px 0;}
    @media (max-width:600px){.container{padding:4vw 2vw;width:100%;max-width:100vw;}h2{font-size:1.3em;}button,.lang-btn,#install-btn{font-size:1em;padding:12px 0;}label,.result{font-size:1em;}select,input{font-size:1em;padding:9px;}}
  </style>
</head>
<body>
  <div class="container">
    <div class="btn-row">
      <button type="button" class="lang-btn selected" id="btn-it">ðŸ‡®ðŸ‡¹ Italiano</button>
      <button type="button" class="lang-btn" id="btn-en">ðŸ‡¬ðŸ‡§ English</button>
    </div>
    <h2 id="title">Calcolatore reale capacitÃ  cavo</h2>
    <form id="realForm">
      <label for="cableType" id="lbl-cable">Tipo cavo:</label>
      <select id="cableType" required>
        <option value="">Seleziona</option>
        <option value="2/3">2 AWG / 3 fili (diam 60â€¯cm)</option>
        <option value="2/4">2 AWG / 4 fili (diam 66â€¯cm)</option>
      </select>
      <label for="height" id="lbl-height">Altezza contenitore (<span id="unit">cm</span>):</label>
      <input type="number" id="height" min="10" required placeholder="Es: 70">
      <button type="submit" id="submitBtn">Calcola</button>
    </form>
    <div id="result" class="result" style="display:none;"></div>
    <button id="install-btn" style="display:none;">Installa App</button>
  </div>
  <script>
    // Dati reali forniti dal produttore
    const db = {
      '2/3': [
        {h:56, len:23},
        {h:66, len:30},
        {h:76, len:36}
      ],
      '2/4': [
        {h:60, len:23},
        {h:71, len:30},
        {h:81, len:36}
      ]
    };

    // Testi multilingua
    const texts = {
      it: {
        title: "Calcolatore reale capacitÃ  cavo",
        cable: "Tipo cavo:",
        options: ["Seleziona", "2 AWG / 3 fili (diam 60â€¯cm)", "2 AWG / 4 fili (diam 66â€¯cm)"],
        height: "Altezza contenitore (<span id='unit'>cm</span>):",
        btn: "Calcola",
        result: "Puoi raccogliere circa <b>{X} metri</b> di cavo ({C})",
        legend: "Dati reali del produttore, interpolazione lineare su altezza.",
        noinput: "Seleziona tipo e inserisci l'altezza.",
        install: "Installa App"
      },
      en: {
        title: "Real cable capacity calculator",
        cable: "Cable type:",
        options: ["Select", "2 AWG / 3 wires (60â€¯cm diam)", "2 AWG / 4 wires (66â€¯cm diam)"],
        height: "Container height (<span id='unit'>cm</span>):",
        btn: "Calculate",
        result: "You can fit about <b>{X} meters</b> of cable ({C})",
        legend: "Real manufacturer data, linear interpolation on height.",
        noinput: "Select cable type and enter height.",
        install: "Install App"
      }
    };
    let currentLang = 'it';
    function setLang(lang) {
      currentLang = lang;
      const t = texts[lang];
      document.getElementById('title').textContent = t.title;
      document.getElementById('lbl-cable').textContent = t.cable;
      document.getElementById('lbl-height').innerHTML = t.height;
      document.getElementById('submitBtn').textContent = t.btn;
      document.getElementById('install-btn').textContent = t.install;
      const opts = document.getElementById('cableType').options;
      opts[0].text = t.options[0];
      opts[1].text = t.options[1];
      opts[2].text = t.options[2];
      document.getElementById('height').placeholder = lang === 'it' ? 'Es: 70' : 'e.g. 70';
      document.getElementById('height').value = '';
      document.getElementById('result').style.display = "none";
      document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('selected'));
      document.getElementById(lang === 'it' ? 'btn-it' : 'btn-en').classList.add('selected');
    }
    document.getElementById('btn-it').onclick = () => setLang('it');
    document.getElementById('btn-en').onclick = () => setLang('en');
    setLang('it'); // default

    // Interpolazione lineare su altezza (dati reali)
    function interpolate(data, h) {
      data = data.sort((a, b) => a.h - b.h);
      if (h <= data[0].h) return data[0].len * h / data[0].h;
      if (h >= data[data.length-1].h) return data[data.length-1].len * h / data[data.length-1].h;
      for (let i = 1; i < data.length; i++) {
        if (h <= data[i].h) {
          let x0 = data[i-1].h, y0 = data[i-1].len;
          let x1 = data[i].h, y1 = data[i].len;
          return y0 + (y1 - y0) * (h - x0) / (x1 - x0);
        }
      }
    }

    document.getElementById('realForm').onsubmit = function(e) {
      e.preventDefault();
      const tipo = document.getElementById('cableType').value;
      const h = parseFloat(document.getElementById('height').value);
      const res = document.getElementById('result');
      const t = texts[currentLang];
      if (!tipo || isNaN(h)) {
        res.style.display = "block";
        res.innerHTML = t.noinput;
        return;
      }
      let data = db[tipo];
      if (!data) {
        res.style.display = "block";
        res.innerHTML = "Diametro non supportato.";
        return;
      }
      let len = interpolate(data, h);
      let descr = document.querySelector('#cableType option:checked').textContent;
      res.style.display = "block";
      res.innerHTML = t.result.replace('{X}', len.toFixed(1)).replace('{C}', descr)
        + "<br><span style='font-size:0.96em;'>" + t.legend + "</span>";
    };

    // ---- PWA install prompt ----
    let deferredPrompt;
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      document.getElementById('install-btn').style.display = 'block';
    });
    document.getElementById('install-btn').addEventListener('click', () => {
      if (deferredPrompt) {
        deferredPrompt.prompt();
        deferredPrompt.userChoice.then(() => { deferredPrompt = null; });
      }
    });

    // Service worker registration
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
        navigator.serviceWorker.register('service-worker.js');
      });
    }
  </script>
</body>
</html>
